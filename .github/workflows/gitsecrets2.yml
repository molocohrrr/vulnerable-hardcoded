name: Git-secrets Scan CLI

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  gitsecrets-scan:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Install Git-secrets
        run: |
          # Install Git-secrets
          wget -qO- https://raw.githubusercontent.com/awslabs/git-secrets/main/git-secrets-2.4.0.tar.gz | tar xvz
          cd git-secrets-2.4.0 && sudo make install

      - name: Run Git-secrets
        id: gitsecrets
        run: |
          git secrets --scan --recurse --no-textconv --allowed --signoff

      - name: Display Git-secrets Report
        if: success()
        run: |
          git secrets --scan --recurse --no-textconv --allowed --signoff

      - name: Finalize
        if: always()
        run: echo "Git-secrets scan completed."
